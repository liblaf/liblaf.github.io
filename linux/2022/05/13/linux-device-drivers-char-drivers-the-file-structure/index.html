<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="prefer-datetime-locale" content="en">
<meta name="generator" content="Jekyll v4.2.2">
<meta property="og:title" content="Linux Device Drivers Char Drivers The file Structure">
<meta property="og:locale" content="en">
<meta name="description" content="1 2 #include &lt;linux/fs.h&gt; struct file { ... };">
<meta property="og:description" content="1 2 #include &lt;linux/fs.h&gt; struct file { ... };">
<link rel="canonical" href="https://blog.liblaf.top/linux/2022/05/13/linux-device-drivers-char-drivers-the-file-structure/">
<meta property="og:url" content="https://blog.liblaf.top/linux/2022/05/13/linux-device-drivers-char-drivers-the-file-structure/">
<meta property="og:site_name" content="liblaf's Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-05-13T00:00:00+08:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Linux Device Drivers Char Drivers The file Structure">
<meta name="twitter:site" content="@twitter_username"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-13T00:00:00+08:00","datePublished":"2022-05-13T00:00:00+08:00","description":"1 2 #include &lt;linux/fs.h&gt; struct file { ... };","headline":"Linux Device Drivers Char Drivers The file Structure","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.liblaf.top/linux/2022/05/13/linux-device-drivers-char-drivers-the-file-structure/"},"url":"https://blog.liblaf.top/linux/2022/05/13/linux-device-drivers-char-drivers-the-file-structure/"}</script><title>Linux Device Drivers | Char Drivers | The file Structure | liblaf's Blog</title>
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="liblaf's Blog">
<meta name="application-name" content="liblaf's Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="dns-prefetch" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="dns-prefetch" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&amp;display=swap">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/auto_number.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script>
</head>
<body data-spy="scroll" data-target="#toc" data-topbar-visible="true">
<div id="sidebar" class="d-flex flex-column align-items-end">
<div class="profile-wrapper text-center">
<div id="avatar"> <a href="/" class="mx-auto"> <img src="https://cdn.liblaf.top/avatar-transparent.png" alt="avatar" onerror="this.style.display='none'"> </a>
</div>
<div class="site-title mt-3"> <a href="/">liblaf's Blog</a>
</div>
<div class="site-subtitle font-italic">Life blooms like a flower</div>
</div>
<ul class="w-100">
<li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a>
</li>
<li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a>
</li>
<li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a>
</li>
<li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a>
</li>
<li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a>
</li>
</ul>
<div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/liblaf" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="javascript:location.href%20=%20'mailto:'%20+%20%5B'liblaf','outlook.com'%5D.join('@')" aria-label="email"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss"> <i class="fas fa-rss"></i> </a> <a href="https://stackoverflow.com/users/18410348/liblaf" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a>
</div>
</div>
<div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Linux Device Drivers | Char Drivers | The file Structure</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div>
<i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel">Cancel</span>
</div></div>
<div id="main-wrapper" class="d-flex justify-content-center">
<div id="main" class="container pl-xl-4 pr-xl-4">
<div class="row">
<div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2">
<h1 data-toc-skip>Linux Device Drivers | Char Drivers | The file Structure</h1>
<div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1652371200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 13, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/liblaf">Qin Li</a> </em> </span><div> <span id="busuanzi_container_page_pv"> <em id="pv" class="pageviews"> <span id="busuanzi_value_page_pv"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> </em> views </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="518 words"> <em>2 min</em> read</span> <span> <em> <a href="https://github.com/liblaf/blog/tree/main/_posts/linux/2022-05-13-linux-device-drivers-char-drivers-the-file-structure.md"> <i class="fas fa-eye"></i> View on GitHub </a> </em> </span>
</div>
</div>
</div>
<div class="post-content">
<div class="language-c highlighter-rouge">
<div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;linux/fs.h&gt;</span><span class="cp">
</span><span class="k">struct</span> <span class="n">file</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<h2 id="f_mode">
<span class="mr-2">f_mode</span><a href="#f_mode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="n">mode_t</span> <span class="n">f_mode</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>The file mode identifies the file as either readable or writable (or both), by means of the bits <code class="language-plaintext highlighter-rouge">FMODE_READ</code> and <code class="language-plaintext highlighter-rouge">FMODE_WRITE</code>. You might want to check this field for read/write permission in your <code class="language-plaintext highlighter-rouge">open</code> or <code class="language-plaintext highlighter-rouge">ioctl</code> function, but you don’t need to check permissions for <code class="language-plaintext highlighter-rouge">read</code> and <code class="language-plaintext highlighter-rouge">write</code>, because the kernel checks before invoking your method. An attempt to read or write when the file has not been opened for that type of access is rejected without the driver even knowing about it.</p>
<h2 id="f_pos">
<span class="mr-2">f_pos</span><a href="#f_pos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="n">loff_t</span> <span class="n">f_pos</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>The current reading or writing position. <code class="language-plaintext highlighter-rouge">loff_t</code> is a 64-bit value on all platforms (<code class="language-plaintext highlighter-rouge">long long</code> in <code class="language-plaintext highlighter-rouge">gcc</code> terminology). The driver can read this value if it needs to know the current position in the file but should not normally change it; <code class="language-plaintext highlighter-rouge">read</code> and <code class="language-plaintext highlighter-rouge">write</code> should update a position using the pointer they receive as the last argument instead of acting on <code class="language-plaintext highlighter-rouge">filp-&gt;f_pos</code> directly. The one exception to this rule is in the <code class="language-plaintext highlighter-rouge">llseek</code> method, the purpose of which is to change the file position.</p>
<h2 id="f_flags">
<span class="mr-2">f_flags</span><a href="#f_flags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">f_flags</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>These are the file flags, such as <code class="language-plaintext highlighter-rouge">O_RDONLY</code>, <code class="language-plaintext highlighter-rouge">O_NONBLOCK</code>, and <code class="language-plaintext highlighter-rouge">O_SYNC</code>. A driver should check the <code class="language-plaintext highlighter-rouge">O_NONBLOCK</code> flag to see if nonblocking operation has been requested (we discuss nonblocking I/O in the section "Blocking and Nonblocking Operations" in Chapter 6); the other flags are seldom used. In particular, read/write permission should be checked using <code class="language-plaintext highlighter-rouge">f_mode</code> rather than <code class="language-plaintext highlighter-rouge">f_flags</code>. All the flags are defined in the header <code class="language-plaintext highlighter-rouge">&lt;linux/fcntl.h&gt;</code>.</p>
<h2 id="f_op">
<span class="mr-2">f_op</span><a href="#f_op" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">struct</span> <span class="n">file_operations</span> <span class="o">*</span><span class="n">f_op</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>The operations associated with the file. The kernel assigns the pointer as part of its implementation of <code class="language-plaintext highlighter-rouge">open</code> and then reads it when it needs to dispatch any operations. The value in <code class="language-plaintext highlighter-rouge">filp-&gt;f_op</code> is never saved by the kernel for later reference; this means that you can change the file operations associated with your file, and the new methods will be effective after you return to the caller. For example, the code for <code class="language-plaintext highlighter-rouge">open</code> associated with major number 1 (<code class="language-plaintext highlighter-rouge">/dev/null</code>, <code class="language-plaintext highlighter-rouge">/dev/zero</code>, and so on) substitutes the operations in <code class="language-plaintext highlighter-rouge">filp-&gt;f_op</code> depending on the minor number being opened. This practice allows the implementation of several behaviors under the same major number without introducing overhead at each system call. The ability to replace the file operations is the kernel equivalent of "method overriding" in object-oriented programming.</p>
<h2 id="private_data">
<span class="mr-2">private_data</span><a href="#private_data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>The <code class="language-plaintext highlighter-rouge">open</code> system call sets this pointer to <code class="language-plaintext highlighter-rouge">NULL</code> before calling the <code class="language-plaintext highlighter-rouge">open</code> method for the driver. You are free to make its own use of the field or to ignore it; you can use the field to point to allocated data, but then you must remember to free that memory in the <code class="language-plaintext highlighter-rouge">release</code> method before the <code class="language-plaintext highlighter-rouge">file</code> structure is destroyed by the kernel. <code class="language-plaintext highlighter-rouge">private_data</code> is a useful resource for preserving state information across system calls and is used by most of our sample modules.</p>
<h2 id="f_dentry">
<span class="mr-2">f_dentry</span><a href="#f_dentry" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">f_dentry</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>The directory entry (<code class="language-plaintext highlighter-rouge">dentry</code>) structure associated with the file. Device driver writers normally need not concern themselves with <code class="language-plaintext highlighter-rouge">dentry</code> structures, other than to access the <code class="language-plaintext highlighter-rouge">inode</code> structure as <code class="language-plaintext highlighter-rouge">filp-&gt;f_dentry-&gt;d_inode</code>.</p>
</div>
<div class="post-tail-wrapper text-muted">
<div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href="/categories/linux/">Linux</a>
</div>
<div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/oslab/" class="post-tag no-text-decoration">OSLAB</a> <a href="/tags/linux-kernel/" class="post-tag no-text-decoration">Linux Kernel</a> <a href="/tags/linux-device-drivers/" class="post-tag no-text-decoration">Linux Device Drivers</a> <a href="/tags/char-drivers/" class="post-tag no-text-decoration">Char Drivers</a>
</div>
<div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
<div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div>
<div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Linux+Device+Drivers+%7C+Char+Drivers+%7C+The+file+Structure+-+liblaf%27s+Blog&amp;url=https%3A%2F%2Fblog.liblaf.top%2Flinux%2F2022%2F05%2F13%2Flinux-device-drivers-char-drivers-the-file-structure%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Linux+Device+Drivers+%7C+Char+Drivers+%7C+The+file+Structure+-+liblaf%27s+Blog&amp;u=https%3A%2F%2Fblog.liblaf.top%2Flinux%2F2022%2F05%2F13%2Flinux-device-drivers-char-drivers-the-file-structure%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fblog.liblaf.top%2Flinux%2F2022%2F05%2F13%2Flinux-device-drivers-char-drivers-the-file-structure%2F&text=Linux+Device+Drivers+%7C+Char+Drivers+%7C+The+file+Structure+-+liblaf%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fblog.liblaf.top%2Flinux%2F2022%2F05%2F13%2Flinux-device-drivers-char-drivers-the-file-structure%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Linux+Device+Drivers+%7C+Char+Drivers+%7C+The+file+Structure+-+liblaf%27s+Blog&amp;url=https%3A%2F%2Fblog.liblaf.top%2Flinux%2F2022%2F05%2F13%2Flinux-device-drivers-char-drivers-the-file-structure%2F" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span>
</div>
</div>
</div>
</div></div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">
<div class="access">
<div id="access-lastmod" class="post">
<div class="panel-heading">Recently Updated</div>
<ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/linux/2022/01/26/how-to-build-linux-kernel/">How to Build Linux Kernel</a></li></ul>
</div>
<div id="access-tags">
<div class="panel-heading">Trending Tags</div>
<div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hpc/">HPC</a> <a class="post-tag" href="/tags/bomb-lab/">Bomb Lab</a> <a class="post-tag" href="/tags/oslab/">OSLAB</a> <a class="post-tag" href="/tags/untagged/">untagged</a> <a class="post-tag" href="/tags/linux-kernel/">Linux Kernel</a> <a class="post-tag" href="/tags/linux-device-drivers/">Linux Device Drivers</a> <a class="post-tag" href="/tags/attack-lab/">Attack Lab</a> <a class="post-tag" href="/tags/cuda/">CUDA</a> <a class="post-tag" href="/tags/mpi/">MPI</a> <a class="post-tag" href="/tags/char-drivers/">Char Drivers</a>
</div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5">
<div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
<nav id="toc" data-toggle="toc"></nav>
</div>
</div>
</div>
<div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4">
<div id="related-posts" class="mt-5 mb-2 mb-sm-4">
<h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
<div class="card-deck mb-4">
<div class="card"> <a href="/linux/2022/05/13/linux-device-drivers-char-drivers-file-operations/"><div class="card-body"> <em class="small" data-ts="1652371200" data-df="ll"> May 13, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux Device Drivers | Char Drivers | File Operations</h3>
<div class="text-muted small"><p> #include &amp;lt;linux/fs.h&amp;gt; struct file_operations { ... }; owner struct module *owner The first file_operations field is not an operation at all; it is a pointer to the module that "owns" the...</p></div>
</div></a>
</div>
<div class="card"> <a href="/linux/2022/05/13/linux-device-drivers-allocating-memory/"><div class="card-body"> <em class="small" data-ts="1652371200" data-df="ll"> May 13, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux Device Drivers | Allocating Memory</h3>
<div class="text-muted small"><p> &amp;lt;linux/slab.h&amp;gt; void *kmalloc(size_t size, int flags); void kfree(void *obj); The most frequently used interface to memory allocation. &amp;lt;linux/mm.h&amp;gt; GFP_USER GFP_KERNEL GFP_NOFS GFP_...</p></div>
</div></a>
</div>
<div class="card"> <a href="/linux/2022/05/13/linux-device-drivers-building-and-running-modules/"><div class="card-body"> <em class="small" data-ts="1652371200" data-df="ll"> May 13, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux Device Drivers | Building and Running Modules</h3>
<div class="text-muted small"><p> Utilities insmod modprobe rmmod User-space utilities that load modules into the running kernels and remove them. &amp;lt;linux/init.h&amp;gt; module_init(init_function); module_exit(cleanup_function);...</p></div>
</div></a>
</div>
</div>
</div>
<div class="post-navigation d-flex justify-content-between"> <a href="/linux/2022/05/13/linux-device-drivers-char-drivers-file-operations/" class="btn btn-outline-primary" prompt="Older"><p>Linux Device Drivers | Char Drivers | File Operations</p></a> <a href="/linux/2022/05/13/linux-device-drivers-char-drivers/" class="btn btn-outline-primary" prompt="Newer"><p>Linux Device Drivers | Char Drivers</p></a>
</div>
<script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "liblaf/blog", "data-repo-id": "R_kgDOHkfdiA", "data-category": "General", "data-category-id": "DIC_kwDOHkfdiM4CP6eD", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "top", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script>
</div></div>
<footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0">
<div class="footer-left"> <span id="busuanzi_container_site_pv"> <b class="pageviews"> <span id="busuanzi_value_site_pv"> <i class="fas fa-spinner fa-spin fa-fw"></i> </span> </b> site views </span><p class="mb-0"> © 2022 <a href="https://github.com/liblaf">Qin Li</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p>
</div>
<div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div>
</div></footer>
</div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content">
<div id="search-hints"><div id="access-tags">
<div class="panel-heading">Trending Tags</div>
<div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hpc/">HPC</a> <a class="post-tag" href="/tags/bomb-lab/">Bomb Lab</a> <a class="post-tag" href="/tags/oslab/">OSLAB</a> <a class="post-tag" href="/tags/untagged/">untagged</a> <a class="post-tag" href="/tags/linux-kernel/">Linux Kernel</a> <a class="post-tag" href="/tags/linux-device-drivers/">Linux Device Drivers</a> <a class="post-tag" href="/tags/attack-lab/">Attack Lab</a> <a class="post-tag" href="/tags/cuda/">CUDA</a> <a class="post-tag" href="/tags/mpi/">MPI</a> <a class="post-tag" href="/tags/char-drivers/">Char Drivers</a>
</div>
</div></div>
<div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
</div></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div>
<a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false">
<div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">×</span> </button>
</div>
<div class="toast-body text-center pt-0">
<p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
<button type="button" class="btn btn-primary" aria-label="Update"> Update </button>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/math.js" defer></script> <script id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-svg-full.js" defer></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"> </script>
</body>
</html>
